<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>PCSMT-2 项目功能实现文档 | PCSMT2 文档</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="icon" href="/PCSMT2-Docs/img/PCSMT2.png">
    <meta name="description" content="PCSMT2 文档">
    
    <link rel="preload" href="/PCSMT2-Docs/assets/css/0.styles.558b2f72.css" as="style"><link rel="preload" href="/PCSMT2-Docs/assets/js/app.079f457c.js" as="script"><link rel="preload" href="/PCSMT2-Docs/assets/js/2.a3152b48.js" as="script"><link rel="preload" href="/PCSMT2-Docs/assets/js/1.2e31b332.js" as="script"><link rel="preload" href="/PCSMT2-Docs/assets/js/34.3cbb78b6.js" as="script"><link rel="prefetch" href="/PCSMT2-Docs/assets/js/10.70d6899a.js"><link rel="prefetch" href="/PCSMT2-Docs/assets/js/11.85b51352.js"><link rel="prefetch" href="/PCSMT2-Docs/assets/js/12.85d44f85.js"><link rel="prefetch" href="/PCSMT2-Docs/assets/js/13.6d343478.js"><link rel="prefetch" href="/PCSMT2-Docs/assets/js/14.0d69663f.js"><link rel="prefetch" href="/PCSMT2-Docs/assets/js/15.96c501bb.js"><link rel="prefetch" href="/PCSMT2-Docs/assets/js/16.52893ae4.js"><link rel="prefetch" href="/PCSMT2-Docs/assets/js/17.80f90eb0.js"><link rel="prefetch" href="/PCSMT2-Docs/assets/js/18.a5cd5eab.js"><link rel="prefetch" href="/PCSMT2-Docs/assets/js/19.137069a0.js"><link rel="prefetch" href="/PCSMT2-Docs/assets/js/20.2925e437.js"><link rel="prefetch" href="/PCSMT2-Docs/assets/js/21.93c33fa5.js"><link rel="prefetch" href="/PCSMT2-Docs/assets/js/22.39c8c917.js"><link rel="prefetch" href="/PCSMT2-Docs/assets/js/23.3b122fc9.js"><link rel="prefetch" href="/PCSMT2-Docs/assets/js/24.97660fd2.js"><link rel="prefetch" href="/PCSMT2-Docs/assets/js/25.dca6d7e6.js"><link rel="prefetch" href="/PCSMT2-Docs/assets/js/26.4bd803fa.js"><link rel="prefetch" href="/PCSMT2-Docs/assets/js/27.262d94eb.js"><link rel="prefetch" href="/PCSMT2-Docs/assets/js/28.4ecfb3b8.js"><link rel="prefetch" href="/PCSMT2-Docs/assets/js/29.17639f69.js"><link rel="prefetch" href="/PCSMT2-Docs/assets/js/3.f7531634.js"><link rel="prefetch" href="/PCSMT2-Docs/assets/js/30.56b2d009.js"><link rel="prefetch" href="/PCSMT2-Docs/assets/js/31.2ba0bc7d.js"><link rel="prefetch" href="/PCSMT2-Docs/assets/js/32.310911ed.js"><link rel="prefetch" href="/PCSMT2-Docs/assets/js/33.4ffdda33.js"><link rel="prefetch" href="/PCSMT2-Docs/assets/js/35.f755d516.js"><link rel="prefetch" href="/PCSMT2-Docs/assets/js/36.4c290e56.js"><link rel="prefetch" href="/PCSMT2-Docs/assets/js/37.6575722c.js"><link rel="prefetch" href="/PCSMT2-Docs/assets/js/4.1b176ca8.js"><link rel="prefetch" href="/PCSMT2-Docs/assets/js/5.d3e11f2f.js"><link rel="prefetch" href="/PCSMT2-Docs/assets/js/6.ca665621.js"><link rel="prefetch" href="/PCSMT2-Docs/assets/js/7.a380a45d.js"><link rel="prefetch" href="/PCSMT2-Docs/assets/js/vendors~docsearch.ef62c33d.js">
    <link rel="stylesheet" href="/PCSMT2-Docs/assets/css/0.styles.558b2f72.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/PCSMT2-Docs/" class="home-link router-link-active"><!----> <span class="site-name">PCSMT2 文档</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/PCSMT2-Docs/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="外部链接" class="dropdown-title"><span class="title">外部链接</span> <span class="arrow down"></span></button> <button type="button" aria-label="外部链接" class="mobile-dropdown-title"><span class="title">外部链接</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://ksayus.github.io/PCSMT-2/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  PCSMT2
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/ksayus/PCSMT-2" target="_blank" rel="noopener noreferrer" class="nav-link external">
  PCSMT2 项目
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><a href="/PCSMT2-Docs/pages/future.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  未来规划
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/PCSMT2-Docs/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="外部链接" class="dropdown-title"><span class="title">外部链接</span> <span class="arrow down"></span></button> <button type="button" aria-label="外部链接" class="mobile-dropdown-title"><span class="title">外部链接</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://ksayus.github.io/PCSMT-2/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  PCSMT2
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/ksayus/PCSMT-2" target="_blank" rel="noopener noreferrer" class="nav-link external">
  PCSMT2 项目
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><a href="/PCSMT2-Docs/pages/future.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  未来规划
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>使用指南</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/PCSMT2-Docs/pages/" aria-current="page" class="sidebar-link">使用文档</a></li><li><a href="/PCSMT2-Docs/pages/install.html" class="sidebar-link">安装</a></li><li><a href="/PCSMT2-Docs/pages/faq.html" class="sidebar-link">常见问题</a></li><li><a href="/PCSMT2-Docs/pages/command.html" class="sidebar-link">命令行使用</a></li><li><a href="/PCSMT2-Docs/pages/api.html" class="sidebar-link">API 文档</a></li><li><a href="/PCSMT2-Docs/pages/interface.html" class="sidebar-link">API 接口</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>配置</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/PCSMT2-Docs/pages/configure/config.html" class="sidebar-link">配置文件</a></li><li><a href="/PCSMT2-Docs/pages/configure/configure.html" class="sidebar-link">配置</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>API 文档</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/PCSMT2-Docs/pages/api/" class="sidebar-link">API 接口 导航</a></li><li><a href="/PCSMT2-Docs/pages/api/program.html" class="sidebar-link">程序 API 接口</a></li><li><a href="/PCSMT2-Docs/pages/api/server.html" class="sidebar-link">服务器 API 接口</a></li><li><a href="/PCSMT2-Docs/pages/api/resource.html" class="sidebar-link">资源 API 接口</a></li><li><a href="/PCSMT2-Docs/pages/api/page.html" class="sidebar-link">页面 API 接口</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="pcsmt-2-项目功能实现文档"><a href="#pcsmt-2-项目功能实现文档" class="header-anchor">#</a> PCSMT-2 项目功能实现文档</h1> <p>PCSMT-2 已经停止更新, 后续版本将不再维护.</p> <h2 id="_1-项目概述"><a href="#_1-项目概述" class="header-anchor">#</a> 1. 项目概述</h2> <p>PCSMT-2（Python Minecraft Server Manager Tool 2）是一个功能全面的Minecraft服务器管理工具，支持GUI界面、命令行操作和Web管理界面，提供从服务器创建、配置、启动到监控的全生命周期管理。</p> <h3 id="_1-1-主要特性"><a href="#_1-1-主要特性" class="header-anchor">#</a> 1.1 主要特性</h3> <ul><li>多版本Java自动管理与安装</li> <li>服务器添加、配置、启动、停止、删除等核心功能</li> <li>定时任务与服务器监控</li> <li>RCON协议支持实现远程控制</li> <li>备份与回档功能</li> <li>Web API接口</li> <li>Tkinter GUI界面</li> <li>命令历史记录和自动补全</li></ul> <h2 id="_2-系统架构"><a href="#_2-系统架构" class="header-anchor">#</a> 2. 系统架构</h2> <h3 id="_2-1-核心模块结构"><a href="#_2-1-核心模块结构" class="header-anchor">#</a> 2.1 核心模块结构</h3> <ul><li><strong>主程序模块</strong>：PCSMT2.py，程序入口点，负责初始化GUI、命令行界面和启动相关服务</li> <li><strong>服务器管理模块</strong>：Server.py，实现服务器的添加、启动、停止、删除等核心功能</li> <li><strong>Java管理模块</strong>：Java.py，负责Java版本的检测、安装和配置</li> <li><strong>定时任务模块</strong>：timer.py，实现服务器状态监控和存储大小更新等定时任务</li> <li><strong>Web API模块</strong>：api目录下的相关文件，提供HTTP接口供Web界面调用</li> <li><strong>配置管理</strong>：通过config.json和java_versions.json管理程序配置</li></ul> <h2 id="_3-核心功能实现"><a href="#_3-核心功能实现" class="header-anchor">#</a> 3. 核心功能实现</h2> <h3 id="_3-1-程序初始化流程"><a href="#_3-1-程序初始化流程" class="header-anchor">#</a> 3.1 程序初始化流程</h3> <p>程序启动时执行以下初始化流程：</p> <ol><li><strong>进程检查</strong>：确保只运行一个程序实例，防止冲突</li> <li><strong>Java环境检测</strong>：检查并自动安装所需的Java版本（1.8、16、17、21）</li> <li><strong>配置加载</strong>：读取config.json配置文件</li> <li><strong>定时任务初始化</strong>：启动存储大小更新定时器和心跳检测</li> <li><strong>GUI初始化</strong>：创建Tkinter主窗口和界面组件</li> <li><strong>Web服务器启动</strong>：启动Flask Web API服务</li></ol> <p>核心初始化代码如下：</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment"># 进程检查与窗口置顶</span>
<span class="token keyword">def</span> <span class="token function">SetWindowTop</span><span class="token punctuation">(</span>ProgramName<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 实现进程检查和窗口置顶逻辑</span>

<span class="token comment"># Java环境检测与安装</span>
versions <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1.8</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">]</span>
<span class="token keyword">for</span> version <span class="token keyword">in</span> versions<span class="token punctuation">:</span>
    results <span class="token operator">=</span> Examine<span class="token punctuation">.</span>Java<span class="token punctuation">.</span>Exist<span class="token punctuation">(</span>version<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token keyword">not</span> results<span class="token punctuation">:</span>
        <span class="token comment"># 尝试自动安装Java</span>
        result <span class="token operator">=</span> Java<span class="token punctuation">.</span>Install<span class="token punctuation">.</span>Windows<span class="token punctuation">(</span>version<span class="token punctuation">)</span>

<span class="token comment"># 定时任务启动</span>
timer<span class="token punctuation">.</span>TimerStorageSizeUpdate<span class="token punctuation">.</span>thread<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># Web服务器启动</span>
<span class="token keyword">from</span> <span class="token builtin">bin</span><span class="token punctuation">.</span>api <span class="token keyword">import</span> main

<span class="token comment"># GUI初始化</span>
app <span class="token operator">=</span> TkinterApp<span class="token punctuation">(</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span>MainLoop<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="_3-2-java版本管理功能"><a href="#_3-2-java版本管理功能" class="header-anchor">#</a> 3.2 Java版本管理功能</h3> <p>Java版本管理模块负责检测、安装和配置不同版本的Java环境，支持自动下载和安装Amazon Corretto JDK。</p> <p><strong>核心功能</strong>：</p> <ul><li>自动检测系统已安装的Java版本</li> <li>支持自动下载并安装指定版本的Java（1.8、16、17、21）</li> <li>为不同版本的Minecraft服务器选择合适的Java版本</li> <li>环境变量配置</li></ul> <p><strong>版本匹配逻辑</strong>：</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment"># 根据Minecraft版本选择合适的Java版本</span>
<span class="token keyword">def</span> <span class="token function">JavaVersion</span><span class="token punctuation">(</span>Version<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    java_args<span class="token punctuation">:</span> <span class="token builtin">str</span> <span class="token operator">=</span> <span class="token string">''</span>
    v <span class="token operator">=</span> version<span class="token punctuation">.</span>parse<span class="token punctuation">(</span>Version<span class="token punctuation">)</span>

    <span class="token comment"># 按照版本使用不同版本的Java JDK</span>
    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'./java_versions.json'</span><span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
        java_versions_address <span class="token operator">=</span> json<span class="token punctuation">.</span>load<span class="token punctuation">(</span>f<span class="token punctuation">)</span>
        <span class="token keyword">if</span> v <span class="token operator">&lt;</span> version<span class="token punctuation">.</span>parse<span class="token punctuation">(</span><span class="token string">'1.17.0'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            java_args <span class="token operator">=</span> java_versions_address<span class="token punctuation">[</span><span class="token string">'1.8'</span><span class="token punctuation">]</span>
        <span class="token keyword">elif</span> v <span class="token operator">&gt;</span> version<span class="token punctuation">.</span>parse<span class="token punctuation">(</span><span class="token string">'1.17.0'</span><span class="token punctuation">)</span> <span class="token keyword">and</span> v <span class="token operator">&lt;=</span> version<span class="token punctuation">.</span>parse<span class="token punctuation">(</span><span class="token string">'1.18.2'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            java_args <span class="token operator">=</span> java_versions_address<span class="token punctuation">[</span><span class="token string">'16'</span><span class="token punctuation">]</span>
        <span class="token keyword">elif</span> v <span class="token operator">&gt;</span> version<span class="token punctuation">.</span>parse<span class="token punctuation">(</span><span class="token string">'1.18.2'</span><span class="token punctuation">)</span> <span class="token keyword">and</span> v <span class="token operator">&lt;=</span> version<span class="token punctuation">.</span>parse<span class="token punctuation">(</span><span class="token string">'1.20.4'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            java_args <span class="token operator">=</span> java_versions_address<span class="token punctuation">[</span><span class="token string">'17'</span><span class="token punctuation">]</span>
        <span class="token keyword">elif</span> v <span class="token operator">&gt;</span> version<span class="token punctuation">.</span>parse<span class="token punctuation">(</span><span class="token string">'1.20.5'</span><span class="token punctuation">)</span> <span class="token keyword">and</span> v <span class="token operator">&lt;=</span> version<span class="token punctuation">.</span>parse<span class="token punctuation">(</span><span class="token string">'1.21.8'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            java_args <span class="token operator">=</span> java_versions_address<span class="token punctuation">[</span><span class="token string">'21'</span><span class="token punctuation">]</span>

    <span class="token keyword">return</span> java_args
</code></pre></div><h3 id="_3-3-服务器管理功能"><a href="#_3-3-服务器管理功能" class="header-anchor">#</a> 3.3 服务器管理功能</h3> <p>服务器管理是本程序的核心功能，提供了Minecraft服务器的全生命周期管理。</p> <h4 id="_3-3-1-服务器添加功能"><a href="#_3-3-1-服务器添加功能" class="header-anchor">#</a> 3.3.1 服务器添加功能</h4> <p><strong>功能说明</strong>：将已有的Minecraft服务器目录添加到程序管理中，创建必要的配置文件和启动脚本。</p> <p><strong>实现流程</strong>：</p> <ol><li>扫描指定目录下的服务器核心文件（.jar文件）</li> <li>过滤排除不必要的jar文件</li> <li>创建服务器启动批处理文件</li> <li>生成服务器信息JSON文件，包含名称、路径、核心、大小等信息</li> <li>创建EULA协议文件</li></ol> <p><strong>代码实现</strong>：</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment"># 添加服务器</span>
<span class="token keyword">def</span> <span class="token function">Add</span><span class="token punctuation">(</span>Path<span class="token punctuation">,</span> Name<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 检查路径是否存在</span>
    <span class="token comment"># 查找服务器核心文件</span>
    <span class="token comment"># 过滤排除关键字文件</span>
    <span class="token comment"># 创建启动批处理文件</span>
    <span class="token comment"># 创建服务器信息JSON文件</span>
    <span class="token comment"># 创建EULA协议文件</span>
</code></pre></div><h4 id="_3-3-2-服务器启动功能"><a href="#_3-3-2-服务器启动功能" class="header-anchor">#</a> 3.3.2 服务器启动功能</h4> <p><strong>功能说明</strong>：启动指定的Minecraft服务器，支持nogui模式和内存配置。</p> <p><strong>实现流程</strong>：</p> <ol><li>读取服务器信息文件</li> <li>检查EULA协议是否同意</li> <li>获取或设置服务器端口</li> <li>设置RCON端口（如果启用）</li> <li>根据服务器版本选择合适的Java版本</li> <li>创建并执行启动进程</li> <li>记录服务器启动信息到latest.json和latest.txt</li></ol> <p><strong>代码实现</strong>：</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment"># 启动服务器</span>
<span class="token keyword">def</span> <span class="token function">Start</span><span class="token punctuation">(</span>server_name<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 读取服务器信息</span>
    <span class="token comment"># 检查EULA协议</span>
    <span class="token comment"># 获取服务器端口</span>
    <span class="token comment"># 设置RCON端口</span>
    <span class="token comment"># 选择Java版本</span>
    <span class="token comment"># 创建并执行启动进程</span>
    <span class="token comment"># 记录启动信息</span>
</code></pre></div><h4 id="_3-3-3-服务器停止功能"><a href="#_3-3-3-服务器停止功能" class="header-anchor">#</a> 3.3.3 服务器停止功能</h4> <p><strong>功能说明</strong>：停止指定的Minecraft服务器，支持RCON方式优雅停止和强制停止。</p> <p><strong>实现流程</strong>：</p> <ol><li>尝试通过RCON协议发送/stop命令优雅停止服务器</li> <li>如果RCON方式失败，尝试通过任务管理器结束进程</li></ol> <p><strong>代码实现</strong>：</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment"># 停止服务器</span>
<span class="token keyword">def</span> <span class="token function">Stop</span><span class="token punctuation">(</span>server_name<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 尝试RCON方式停止</span>
    <span class="token comment"># 如果失败，尝试强制停止</span>
</code></pre></div><h4 id="_3-3-4-服务器删除功能"><a href="#_3-3-4-服务器删除功能" class="header-anchor">#</a> 3.3.4 服务器删除功能</h4> <p><strong>功能说明</strong>：从程序中删除指定的服务器，支持保留或删除实际服务器文件。</p> <p><strong>实现流程</strong>：</p> <ol><li>查找服务器信息文件</li> <li>显示服务器信息并请求确认</li> <li>删除服务器信息文件</li> <li>可选删除服务器实际文件</li></ol> <p><strong>代码实现</strong>：</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment"># 删除服务器</span>
<span class="token keyword">def</span> <span class="token function">Delete</span><span class="token punctuation">(</span>server_name<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 查找服务器信息</span>
    <span class="token comment"># 请求确认</span>
    <span class="token comment"># 删除服务器信息文件</span>
    <span class="token comment"># 可选删除服务器文件</span>
</code></pre></div><h4 id="_3-3-5-服务器回档功能"><a href="#_3-3-5-服务器回档功能" class="header-anchor">#</a> 3.3.5 服务器回档功能</h4> <p><strong>功能说明</strong>：将服务器回档到之前的备份状态，支持mod和plugin类型的备份。</p> <p><strong>实现流程</strong>：</p> <ol><li>查找备份文件（支持FTB Backups 2模组和eBackup插件）</li> <li>解压备份文件</li> <li>替换现有服务器文件</li> <li>处理权限问题</li></ol> <p><strong>代码实现</strong>：</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment"># 服务器回档</span>
<span class="token keyword">def</span> <span class="token function">Retracement</span><span class="token punctuation">(</span>server_name<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 查找备份文件</span>
    <span class="token comment"># 解压备份</span>
    <span class="token comment"># 替换服务器文件</span>
    <span class="token comment"># 处理权限</span>
</code></pre></div><h4 id="_3-3-6-服务器属性修改功能"><a href="#_3-3-6-服务器属性修改功能" class="header-anchor">#</a> 3.3.6 服务器属性修改功能</h4> <p><strong>功能说明</strong>：修改服务器的配置属性，如服务器端口、游戏模式、难度等。</p> <p><strong>实现流程</strong>：</p> <ol><li>读取服务器server.properties文件</li> <li>查找指定关键字</li> <li>修改对应的值</li> <li>保存文件</li></ol> <p><strong>代码实现</strong>：</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment"># 修改服务器属性</span>
<span class="token keyword">class</span> <span class="token class-name">Change</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">Properties</span><span class="token punctuation">(</span>server_name<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> keyword<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> argument<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 读取服务器信息</span>
        <span class="token comment"># 查找并修改关键字参数</span>
</code></pre></div><h4 id="_3-3-7-服务器运行内存修改功能"><a href="#_3-3-7-服务器运行内存修改功能" class="header-anchor">#</a> 3.3.7 服务器运行内存修改功能</h4> <p><strong>功能说明</strong>：修改服务器启动时的内存配置（最小内存和最大内存）。</p> <p><strong>实现流程</strong>：</p> <ol><li>读取服务器启动批处理文件</li> <li>修改-Xms和-Xmx参数</li> <li>保存文件</li></ol> <p><strong>代码实现</strong>：</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment"># 修改服务器运行内存</span>
<span class="token keyword">class</span> <span class="token class-name">Change</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">RunningMemories</span><span class="token punctuation">(</span>server_name<span class="token punctuation">,</span> memory_min<span class="token punctuation">,</span> memory_max<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 读取服务器信息</span>
        <span class="token comment"># 修改启动批处理文件中的内存参数</span>
        <span class="token comment"># 保存文件</span>
</code></pre></div><h3 id="_3-4-定时任务与监控功能"><a href="#_3-4-定时任务与监控功能" class="header-anchor">#</a> 3.4 定时任务与监控功能</h3> <p>定时任务模块负责定期更新服务器存储大小和监控服务器在线状态。</p> <h4 id="_3-4-1-存储大小更新功能"><a href="#_3-4-1-存储大小更新功能" class="header-anchor">#</a> 3.4.1 存储大小更新功能</h4> <p><strong>功能说明</strong>：定期更新并记录服务器存储大小，支持配置更新频率。</p> <p><strong>实现流程</strong>：</p> <ol><li>为每个服务器创建单独的定时任务线程</li> <li>定期检查服务器存储大小</li> <li>如果大小有变化，记录到存储大小文件</li> <li>更新服务器信息文件中的大小字段</li></ol> <p><strong>代码实现</strong>：</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment"># 存储大小更新定时器</span>
<span class="token keyword">class</span> <span class="token class-name">TimerStorageSizeUpdate</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">thread</span><span class="token punctuation">(</span>cls<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 为每个服务器创建定时任务线程</span>
        <span class="token comment"># 启动线程</span>

    <span class="token keyword">def</span> <span class="token function">timer</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> server_name<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 定时检查存储大小</span>
        <span class="token comment"># 更新存储大小记录</span>
</code></pre></div><h4 id="_3-4-2-服务器心跳检测功能"><a href="#_3-4-2-服务器心跳检测功能" class="header-anchor">#</a> 3.4.2 服务器心跳检测功能</h4> <p><strong>功能说明</strong>：定期检测服务器在线状态，更新服务器状态信息。</p> <p><strong>实现流程</strong>：</p> <ol><li>创建心跳检测线程</li> <li>定期检查所有服务器的在线状态</li> <li>维护服务器状态列表</li></ol> <p><strong>代码实现</strong>：</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment"># 服务器心跳检测</span>
<span class="token keyword">class</span> <span class="token class-name">Heartbeat</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">thread</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 创建并启动心跳检测线程</span>

    <span class="token keyword">def</span> <span class="token function">Start</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 定期检测服务器状态</span>

    <span class="token keyword">def</span> <span class="token function">GetInfo</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 获取并更新服务器状态信息</span>
</code></pre></div><h3 id="_3-5-rcon协议功能"><a href="#_3-5-rcon协议功能" class="header-anchor">#</a> 3.5 RCON协议功能</h3> <p>RCON协议功能允许程序与Minecraft服务器进行远程通信，执行命令和获取信息。</p> <p><strong>核心功能</strong>：</p> <ul><li>建立RCON连接</li> <li>发送命令（如ban、op、stop等）</li> <li>接收命令执行结果</li> <li>服务器在线状态检测</li></ul> <p><strong>应用场景</strong>：</p> <ul><li>封禁/解封玩家（do_banned/do_unban命令）</li> <li>添加/删除OP玩家（do_op/do_deop命令）</li> <li>优雅停止服务器（do_stop_server命令）</li> <li>获取服务器状态信息</li></ul> <h3 id="_3-6-gui界面实现"><a href="#_3-6-gui界面实现" class="header-anchor">#</a> 3.6 GUI界面实现</h3> <p>程序使用Tkinter库实现图形用户界面，提供直观的操作体验。</p> <p><strong>核心组件</strong>：</p> <ul><li>主窗口：支持自定义大小和位置</li> <li>顶部按钮区域：包含帮助、调试模式等功能按钮</li> <li>日志输出区域：使用ScrolledText组件显示程序日志</li> <li>命令输入区域：支持命令输入和自动补全</li> <li>状态栏：显示程序版本信息</li></ul> <p><strong>交互功能</strong>：</p> <ul><li>命令历史记录：支持上下键导航历史命令</li> <li>命令自动补全：支持Tab键命令和参数补全</li> <li>日志重定向：将控制台输出重定向到日志区域</li></ul> <p><strong>代码实现</strong>：</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment"># GUI主类</span>
<span class="token keyword">class</span> <span class="token class-name">TkinterApp</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 初始化主窗口</span>
        <span class="token comment"># 创建界面组件</span>
        <span class="token comment"># 绑定事件</span>

    <span class="token keyword">def</span> <span class="token function">CreateWidgets</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 创建按钮区域</span>
        <span class="token comment"># 创建日志输出区域</span>
        <span class="token comment"># 创建命令输入区域</span>

    <span class="token keyword">def</span> <span class="token function">CompleteCommand</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> event<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 实现命令自动补全功能</span>

    <span class="token keyword">def</span> <span class="token function">RunCommand</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> event<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 执行输入的命令</span>
</code></pre></div><h3 id="_3-7-命令行功能实现"><a href="#_3-7-命令行功能实现" class="header-anchor">#</a> 3.7 命令行功能实现</h3> <p>程序基于cmd2库实现命令行功能，提供丰富的命令集。</p> <p><strong>核心命令</strong>：</p> <ul><li><strong>version</strong>：查看程序版本信息</li> <li><strong>about</strong>：查看程序关于信息</li> <li><strong>sta</strong>：显示服务器状态</li> <li><strong>add_server</strong>：添加服务器</li> <li><strong>start_server</strong>：启动服务器</li> <li><strong>server_list</strong>：列出所有服务器</li> <li><strong>change_server_properties</strong>：修改服务器属性</li> <li><strong>change_server_run_memories_config</strong>：修改服务器运行内存</li> <li><strong>delete_server</strong>：删除服务器</li> <li><strong>search_server</strong>：搜索服务器</li> <li><strong>banned/unban</strong>：封禁/解封玩家</li> <li><strong>op/deop</strong>：添加/删除OP玩家</li> <li><strong>stop_server</strong>：停止服务器</li></ul> <p><strong>命令自动补全</strong>：
为主要命令实现了参数自动补全功能，提高用户体验。</p> <p><strong>代码实现</strong>：</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment"># 命令行类</span>
<span class="token keyword">class</span> <span class="token class-name">PCSMT2</span><span class="token punctuation">(</span>Cmd<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">do_version</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> arg<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 显示程序版本信息</span>

    <span class="token keyword">def</span> <span class="token function">do_add_server</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> arg<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 添加服务器命令实现</span>

    <span class="token keyword">def</span> <span class="token function">complete_add_server</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> text<span class="token punctuation">,</span> line<span class="token punctuation">,</span> begidx<span class="token punctuation">,</span> endidx<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 命令补全实现</span>
</code></pre></div><h3 id="_3-8-web-api与管理界面"><a href="#_3-8-web-api与管理界面" class="header-anchor">#</a> 3.8 Web API与管理界面</h3> <p>程序内置Flask Web服务器，提供HTTP API接口，并支持Web管理界面。</p> <p><strong>核心API接口</strong>：</p> <ul><li><code>/api/program/version</code>：获取程序版本信息</li> <li><code>/api/server/list</code>：获取服务器列表</li> <li>其他服务器管理相关接口</li></ul> <p><strong>Web管理界面功能</strong>：</p> <ul><li>服务器列表显示</li> <li>服务器状态监控</li> <li>CPU、内存、磁盘使用率监控</li> <li>服务器操作（启动、停止等）</li> <li>终端日志查看</li></ul> <p><strong>定时刷新功能</strong>：
Web界面使用JavaScript定时器定期刷新服务器状态和监控数据。</p> <h2 id="_4-配置系统"><a href="#_4-配置系统" class="header-anchor">#</a> 4. 配置系统</h2> <p>程序通过配置文件管理各种设置，主要包括：</p> <h3 id="_4-1-config-json配置文件"><a href="#_4-1-config-json配置文件" class="header-anchor">#</a> 4.1 config.json配置文件</h3> <p><strong>主要配置项</strong>：</p> <ul><li><code>PCSMT2_Version</code>：程序版本号</li> <li><code>ReleaseVersion</code>：发布版本类型</li> <li><code>RunningMemories_Min</code>：最小运行内存（MB）</li> <li><code>RunningMemories_Max</code>：最大运行内存（MB）</li> <li><code>Nogui</code>：是否使用nogui模式启动服务器</li> <li><code>EULAGenerateWaitTime</code>：EULA生成等待时间</li> <li><code>AutoStartup</code>：自动启动选项</li> <li><code>UpdateSource</code>：更新源（如Github）</li> <li><code>GetMinecraftTestVersion</code>：是否获取测试版服务器版本</li> <li><code>StorageSizeUpdateTime</code>：存储大小更新时间（秒）</li> <li><code>Port</code>：Web服务器端口号</li></ul> <h3 id="_4-2-java-versions-json配置文件"><a href="#_4-2-java-versions-json配置文件" class="header-anchor">#</a> 4.2 java_versions.json配置文件</h3> <p>记录不同Java版本的安装路径，用于服务器启动时选择合适的Java版本。</p> <h2 id="_5-文件结构"><a href="#_5-文件结构" class="header-anchor">#</a> 5. 文件结构</h2> <h3 id="_5-1-主要目录结构"><a href="#_5-1-主要目录结构" class="header-anchor">#</a> 5.1 主要目录结构</h3> <div class="language- extra-class"><pre class="language-text"><code>PCSMT-2/
├── PCSMT2.py              # 主程序文件
├── config.json            # 程序配置文件
├── java_versions.json     # Java版本配置文件
├── bin/                   # 核心功能模块目录
│   ├── command/           # 命令实现模块
│   ├── export/            # 导出和工具模块
│   ├── api/               # Web API模块
│   ├── find_files/        # 文件查找工具
│   └── introduction/      # 介绍信息模块
├── static/                # 静态资源文件
│   ├── js/                # JavaScript文件
│   └── PCSMT2.ico         # 程序图标
└── servers/               # 服务器存储目录
</code></pre></div><h3 id="_5-2-关键文件说明"><a href="#_5-2-关键文件说明" class="header-anchor">#</a> 5.2 关键文件说明</h3> <ul><li><strong>PCSMT2.py</strong>：程序入口点，实现GUI和命令行界面</li> <li><strong>bin/command/Server.py</strong>：服务器管理核心功能实现</li> <li><strong>bin/export/timer.py</strong>：定时任务和监控功能实现</li> <li><strong>bin/export/Java.py</strong>：Java版本管理功能实现</li> <li><strong>bin/api/main.py</strong>：Web API入口点</li></ul> <h2 id="_6-技术栈"><a href="#_6-技术栈" class="header-anchor">#</a> 6. 技术栈</h2> <ul><li><strong>编程语言</strong>：Python</li> <li><strong>GUI框架</strong>：Tkinter</li> <li><strong>Web框架</strong>：Flask</li> <li><strong>服务器通信</strong>：RCON协议</li> <li><strong>并发处理</strong>：多线程</li> <li><strong>配置管理</strong>：JSON文件</li> <li><strong>系统交互</strong>：psutil、subprocess</li> <li><strong>版本管理</strong>：packaging.version</li></ul> <h2 id="_7-未来功能规划"><a href="#_7-未来功能规划" class="header-anchor">#</a> 7. 未来功能规划</h2> <p>根据README中的说明，项目计划在未来实现以下功能：</p> <ul><li>丰富命令和功能</li> <li>支持更多类型的服务器</li> <li>增强服务器管理功能</li></ul> <h2 id="_8-总结"><a href="#_8-总结" class="header-anchor">#</a> 8. 总结</h2> <p>PCSMT-2是一个功能全面的Minecraft服务器管理工具，通过结合GUI、命令行和Web界面，为用户提供了便捷的服务器管理体验。其核心优势在于自动Java版本管理、完善的服务器生命周期管理、实时监控和丰富的命令集。程序采用模块化设计，各功能模块相对独立，便于维护和扩展。</p> <p>通过本文档，希望能够帮助开发者理解PCSMT-2的整体架构和功能实现细节，为后续的项目开发和维护提供参考。</p></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/PCSMT2-Docs/assets/js/app.079f457c.js" defer></script><script src="/PCSMT2-Docs/assets/js/2.a3152b48.js" defer></script><script src="/PCSMT2-Docs/assets/js/1.2e31b332.js" defer></script><script src="/PCSMT2-Docs/assets/js/34.3cbb78b6.js" defer></script>
  </body>
</html>
